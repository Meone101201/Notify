<!DOCTYPE html>
<html lang="th">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Agile Task Board - Story Point Estimation</title>
    <link rel="stylesheet" href="style.css">
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free@6.4.0/css/all.min.css">
    <link rel="icon" type="image/x-icon" href="data:image/svg+xml,<svg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 100 100'><text y='.9em' font-size='90'>üìã</text></svg>">
    
    <!-- Firebase SDK -->
    <script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-firestore-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-auth-compat.js"></script>
</head>
<body>
    <div class="container">
        <!-- Offline Indicator -->
        <div id="offline-indicator" class="offline-indicator" style="display: none;">
            <i class="fas fa-wifi-slash"></i> ‡∏≠‡∏≠‡∏ü‡πÑ‡∏•‡∏ô‡πå - ‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏à‡∏∞‡∏ñ‡∏π‡∏Å‡∏ã‡∏¥‡∏á‡∏Ñ‡πå‡πÄ‡∏°‡∏∑‡πà‡∏≠‡∏Å‡∏•‡∏±‡∏ö‡∏°‡∏≤‡∏≠‡∏≠‡∏ô‡πÑ‡∏•‡∏ô‡πå
        </div>
        
        <header>
            <div class="header-content">
                <div class="header-title">
                    <h1><i class="fas fa-tasks"></i> Agile Task Board</h1>
                    <p class="subtitle">Story Point Estimation System</p>
                </div>
                <div class="user-profile" id="userProfile" style="display: none;">
                    <div class="profile-info">
                        <img id="userAvatar" class="user-avatar" src="" alt="User">
                        <div class="profile-details">
                            <span class="user-name" id="userName">Guest</span>
                            <span class="user-email" id="userEmail">guest@example.com</span>
                        </div>
                    </div>
                    <button class="btn-notification-bell" onclick="toggleNotificationsDropdown()" title="‡∏Å‡∏≤‡∏£‡πÅ‡∏à‡πâ‡∏á‡πÄ‡∏ï‡∏∑‡∏≠‡∏ô">
                        <i class="fas fa-bell" id="notificationBellIcon"></i>
                        <span class="notification-badge" id="notificationBadge" style="display: none;">0</span>
                    </button>
                    <button class="btn-dark-mode-toggle" id="darkModeToggle" title="Switch to Dark Mode">
                        <i class="fas fa-moon"></i>
                    </button>
                    <button class="btn-notification-toggle" onclick="toggleNotificationSettings()" title="‡∏ï‡∏±‡πâ‡∏á‡∏Ñ‡πà‡∏≤‡∏Å‡∏≤‡∏£‡πÅ‡∏à‡πâ‡∏á‡πÄ‡∏ï‡∏∑‡∏≠‡∏ô">
                        <i class="fas fa-cog" id="notificationIcon"></i>
                    </button>
                    <button class="btn-logout" onclick="signOut()" title="‡∏≠‡∏≠‡∏Å‡∏à‡∏≤‡∏Å‡∏£‡∏∞‡∏ö‡∏ö">
                        <i class="fas fa-sign-out-alt"></i>
                    </button>
                </div>
                <div class="login-prompt" id="loginPrompt" style="display: none;">
                    <button class="btn-login-prompt" onclick="showLoginModal()">
                        <i class="fas fa-sign-in-alt"></i> ‡πÄ‡∏Ç‡πâ‡∏≤‡∏™‡∏π‡πà‡∏£‡∏∞‡∏ö‡∏ö
                    </button>
                </div>
            </div>
        </header>

        <!-- Notifications Dropdown -->
        <div class="notifications-dropdown" id="notificationsDropdown" style="display: none;">
            <div class="notifications-dropdown-header">
                <h3><i class="fas fa-bell"></i> ‡∏Å‡∏≤‡∏£‡πÅ‡∏à‡πâ‡∏á‡πÄ‡∏ï‡∏∑‡∏≠‡∏ô</h3>
                <button class="btn-mark-all-read" onclick="markAllNotificationsAsRead()">
                    <i class="fas fa-check-double"></i> ‡∏≠‡πà‡∏≤‡∏ô‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î
                </button>
            </div>
            <div class="notifications-info">
                <i class="fas fa-info-circle"></i>
                <span>‡πÄ‡∏Å‡πá‡∏ö‡πÑ‡∏î‡πâ‡∏™‡∏π‡∏á‡∏™‡∏∏‡∏î 10 ‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£ ‚Ä¢ ‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£‡πÄ‡∏Å‡πà‡∏≤‡∏™‡∏∏‡∏î‡∏à‡∏∞‡∏ñ‡∏π‡∏Å‡∏•‡∏ö‡∏≠‡∏±‡∏ï‡πÇ‡∏ô‡∏°‡∏±‡∏ï‡∏¥</span>
            </div>
            <div class="notifications-dropdown-body" id="notificationsDropdownBody">
                <!-- Notifications will be populated here -->
                <div class="notifications-empty-state">
                    <i class="fas fa-inbox"></i>
                    <p>‡πÑ‡∏°‡πà‡∏°‡∏µ‡∏Å‡∏≤‡∏£‡πÅ‡∏à‡πâ‡∏á‡πÄ‡∏ï‡∏∑‡∏≠‡∏ô</p>
                </div>
            </div>
        </div>

        <div class="stats-container">
            <div class="stat-card">
                <i class="fas fa-list-check"></i>
                <div class="stat-info">
                    <span class="stat-value" id="totalTasks">0</span>
                    <span class="stat-label">‡∏á‡∏≤‡∏ô‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î</span>
                </div>
            </div>
            <div class="stat-card">
                <i class="fas fa-chart-line"></i>
                <div class="stat-info">
                    <span class="stat-value" id="totalPoints">0</span>
                    <span class="stat-label">Story Points ‡∏£‡∏ß‡∏°</span>
                </div>
            </div>
            <div class="stat-card">
                <i class="fas fa-clock"></i>
                <div class="stat-info">
                    <span class="stat-value" id="inProgress">0</span>
                    <span class="stat-label">‡∏Å‡∏≥‡∏•‡∏±‡∏á‡∏ó‡∏≥</span>
                </div>
            </div>
            <div class="stat-card">
                <i class="fas fa-check-circle"></i>
                <div class="stat-info">
                    <span class="stat-value" id="completed">0</span>
                    <span class="stat-label">‡πÄ‡∏™‡∏£‡πá‡∏à‡πÅ‡∏•‡πâ‡∏ß</span>
                </div>
            </div>
        </div>

        <!-- Hamburger Menu Button (Mobile Only) -->
        <button class="hamburger-menu-btn" id="hamburgerBtn" onclick="toggleMobileMenu()">
            <i class="fas fa-bars"></i>
        </button>

        <!-- Navigation Menu -->
        <div class="navigation-menu" id="navigationMenu">
            <div class="mobile-menu-header">
                <h3><i class="fas fa-bars"></i> ‡πÄ‡∏°‡∏ô‡∏π</h3>
                <button class="mobile-menu-close" onclick="toggleMobileMenu()">
                    <i class="fas fa-times"></i>
                </button>
            </div>
            
            <!-- Profile Section in Sidebar (Mobile Only) -->
            <div class="sidebar-profile" id="sidebarProfile" style="display: none;">
                <div class="sidebar-profile-info">
                    <img id="sidebarUserAvatar" class="sidebar-user-avatar" src="" alt="User">
                    <div class="sidebar-profile-details">
                        <span class="sidebar-user-name" id="sidebarUserName">Guest</span>
                        <span class="sidebar-user-email" id="sidebarUserEmail">guest@example.com</span>
                    </div>
                </div>
                
                <!-- Profile Action Buttons -->
                <div class="sidebar-profile-buttons">
                    <button class="sidebar-btn" onclick="closeMobileMenu(); setTimeout(() => toggleNotificationsDropdown(), 300);" title="‡∏Å‡∏≤‡∏£‡πÅ‡∏à‡πâ‡∏á‡πÄ‡∏ï‡∏∑‡∏≠‡∏ô">
                        <i class="fas fa-bell"></i>
                        <span class="sidebar-btn-label">‡∏Å‡∏≤‡∏£‡πÅ‡∏à‡πâ‡∏á‡πÄ‡∏ï‡∏∑‡∏≠‡∏ô</span>
                        <span class="notification-badge" id="sidebarNotificationBadge" style="display: none;">0</span>
                    </button>
                    <button class="sidebar-btn" onclick="handleSidebarDarkModeToggle()" title="‡πÄ‡∏õ‡∏•‡∏µ‡πà‡∏¢‡∏ô‡∏ò‡∏µ‡∏°">
                        <i class="fas fa-moon"></i>
                        <span class="sidebar-btn-label">‡πÇ‡∏´‡∏°‡∏î‡∏°‡∏∑‡∏î</span>
                    </button>
                    <button class="sidebar-btn" onclick="closeMobileMenu(); setTimeout(() => toggleNotificationSettings(), 300);" title="‡∏ï‡∏±‡πâ‡∏á‡∏Ñ‡πà‡∏≤‡∏Å‡∏≤‡∏£‡πÅ‡∏à‡πâ‡∏á‡πÄ‡∏ï‡∏∑‡∏≠‡∏ô">
                        <i class="fas fa-cog"></i>
                        <span class="sidebar-btn-label">‡∏ï‡∏±‡πâ‡∏á‡∏Ñ‡πà‡∏≤</span>
                    </button>
                    <button class="sidebar-btn sidebar-btn-logout" onclick="closeMobileMenu(); setTimeout(() => signOut(), 300);" title="‡∏≠‡∏≠‡∏Å‡∏à‡∏≤‡∏Å‡∏£‡∏∞‡∏ö‡∏ö">
                        <i class="fas fa-sign-out-alt"></i>
                        <span class="sidebar-btn-label">‡∏≠‡∏≠‡∏Å‡∏à‡∏≤‡∏Å‡∏£‡∏∞‡∏ö‡∏ö</span>
                    </button>
                </div>
            </div>
            
            <button class="nav-btn nav-btn-active" id="navTasks" onclick="showTasksPage(); closeMobileMenu();">
                <i class="fas fa-tasks"></i> ‡∏á‡∏≤‡∏ô
            </button>
            <button class="nav-btn" id="navFriends" onclick="showFriendsPage(); closeMobileMenu();">
                <i class="fas fa-user-friends"></i> ‡πÄ‡∏û‡∏∑‡πà‡∏≠‡∏ô
            </button>
            <button class="nav-btn" id="navAchievements" onclick="showAchievementsPage(); closeMobileMenu();">
                <i class="fas fa-trophy"></i> ‡∏≠‡∏ä‡∏µ‡∏ü‡πÄ‡∏°‡∏ô‡∏ï‡πå
            </button>
            <button class="nav-btn" id="navLeaderboard" onclick="showLeaderboardPage(); closeMobileMenu();">
                <i class="fas fa-medal"></i> ‡∏≠‡∏±‡∏ô‡∏î‡∏±‡∏ö
            </button>
        </div>

        <!-- Mobile Menu Overlay -->
        <div class="mobile-menu-overlay" id="mobileMenuOverlay" onclick="closeMobileMenu()"></div>

        <!-- Tasks Page -->
        <div class="tasks-page" id="tasksPage">
        <div class="form-container">
            <h2><i class="fas fa-plus-circle"></i> ‡πÄ‡∏û‡∏¥‡πà‡∏°‡∏á‡∏≤‡∏ô‡∏´‡∏•‡∏±‡∏Å (Epic/User Story)</h2>
            <form id="taskForm">
                <div class="form-row">
                    <div class="form-group full-width">
                        <label for="taskName"><i class="fas fa-pencil"></i> ‡∏ä‡∏∑‡πà‡∏≠‡∏á‡∏≤‡∏ô‡∏´‡∏•‡∏±‡∏Å / User Story</label>
                        <input type="text" id="taskName" placeholder="‡πÄ‡∏ä‡πà‡∏ô: ‡∏û‡∏±‡∏í‡∏ô‡∏≤‡∏£‡∏∞‡∏ö‡∏ö‡∏•‡πá‡∏≠‡∏Å‡∏≠‡∏¥‡∏ô‡πÅ‡∏•‡∏∞‡∏™‡∏°‡∏±‡∏Ñ‡∏£‡∏™‡∏°‡∏≤‡∏ä‡∏¥‡∏Å" required>
                    </div>
                </div>

                <div class="form-row">
                    <div class="form-group">
                        <label for="assignee"><i class="fas fa-user"></i> ‡∏ú‡∏π‡πâ‡∏£‡∏±‡∏ö‡∏ú‡∏¥‡∏î‡∏ä‡∏≠‡∏ö‡∏´‡∏•‡∏±‡∏Å</label>
                        <input type="text" id="assignee" placeholder="‡πÄ‡∏ä‡πà‡∏ô: ‡∏ô‡∏≤‡∏¢ A" required>
                    </div>
                    <div class="form-group">
                        <label for="taskDescription"><i class="fas fa-align-left"></i> ‡∏£‡∏≤‡∏¢‡∏•‡∏∞‡πÄ‡∏≠‡∏µ‡∏¢‡∏î</label>
                        <input type="text" id="taskDescription" placeholder="‡∏≠‡∏ò‡∏¥‡∏ö‡∏≤‡∏¢‡∏á‡∏≤‡∏ô‡πÇ‡∏î‡∏¢‡∏¢‡πà‡∏≠">
                    </div>
                    <div class="form-group">
                        <label for="dueDate"><i class="fas fa-calendar"></i> ‡∏ß‡∏±‡∏ô‡∏Ñ‡∏£‡∏ö‡∏Å‡∏≥‡∏´‡∏ô‡∏î</label>
                        <input type="datetime-local" id="dueDate" required>
                    </div>
                </div>

                <div class="form-row">
                    <div class="form-group">
                        <label for="difficulty"><i class="fas fa-brain"></i> ‡∏Ñ‡∏ß‡∏≤‡∏°‡∏¢‡∏≤‡∏Å (1-5)</label>
                        <select id="difficulty" required>
                            <option value="">‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡∏£‡∏∞‡∏î‡∏±‡∏ö‡∏Ñ‡∏ß‡∏≤‡∏°‡∏¢‡∏≤‡∏Å</option>
                            <option value="1">1 - ‡∏á‡πà‡∏≤‡∏¢‡∏°‡∏≤‡∏Å (‡∏á‡∏≤‡∏ô‡∏ã‡πâ‡∏≥)</option>
                            <option value="2">2 - ‡∏á‡πà‡∏≤‡∏¢ (‡∏°‡∏µ logic ‡πÄ‡∏•‡πá‡∏Å‡∏ô‡πâ‡∏≠‡∏¢)</option>
                            <option value="3">3 - ‡∏õ‡∏≤‡∏ô‡∏Å‡∏•‡∏≤‡∏á (‡∏ï‡πâ‡∏≠‡∏á‡∏Ñ‡∏¥‡∏î)</option>
                            <option value="4">4 - ‡∏¢‡∏≤‡∏Å (‡∏ã‡∏±‡∏ö‡∏ã‡πâ‡∏≠‡∏ô)</option>
                            <option value="5">5 - ‡∏¢‡∏≤‡∏Å‡∏°‡∏≤‡∏Å (‡πÑ‡∏°‡πà‡πÅ‡∏ô‡πà‡∏ô‡∏≠‡∏ô)</option>
                        </select>
                    </div>
                    <div class="form-group">
                        <label for="workload"><i class="fas fa-boxes"></i> ‡∏õ‡∏£‡∏¥‡∏°‡∏≤‡∏ì‡∏á‡∏≤‡∏ô (1-5)</label>
                        <select id="workload" required>
                            <option value="">‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡∏õ‡∏£‡∏¥‡∏°‡∏≤‡∏ì‡∏á‡∏≤‡∏ô</option>
                            <option value="1">1 - ‡∏ô‡πâ‡∏≠‡∏¢‡∏°‡∏≤‡∏Å</option>
                            <option value="2">2 - ‡∏ô‡πâ‡∏≠‡∏¢</option>
                            <option value="3">3 - ‡∏õ‡∏≤‡∏ô‡∏Å‡∏•‡∏≤‡∏á</option>
                            <option value="4">4 - ‡∏°‡∏≤‡∏Å</option>
                            <option value="5">5 - ‡∏°‡∏≤‡∏Å‡∏°‡∏≤‡∏Å</option>
                        </select>
                    </div>
                    <div class="form-group">
                        <label for="risk"><i class="fas fa-exclamation-triangle"></i> ‡∏Ñ‡∏ß‡∏≤‡∏°‡πÄ‡∏™‡∏µ‡πà‡∏¢‡∏á (1-5)</label>
                        <select id="risk" required>
                            <option value="">‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡∏Ñ‡∏ß‡∏≤‡∏°‡πÄ‡∏™‡∏µ‡πà‡∏¢‡∏á</option>
                            <option value="1">1 - ‡πÑ‡∏°‡πà‡∏°‡∏µ‡πÄ‡∏™‡∏µ‡πà‡∏¢‡∏á</option>
                            <option value="2">2 - ‡πÄ‡∏™‡∏µ‡πà‡∏¢‡∏á‡∏ô‡πâ‡∏≠‡∏¢</option>
                            <option value="3">3 - ‡πÄ‡∏™‡∏µ‡πà‡∏¢‡∏á‡∏õ‡∏≤‡∏ô‡∏Å‡∏•‡∏≤‡∏á</option>
                            <option value="4">4 - ‡πÄ‡∏™‡∏µ‡πà‡∏¢‡∏á‡∏™‡∏π‡∏á</option>
                            <option value="5">5 - ‡πÄ‡∏™‡∏µ‡πà‡∏¢‡∏á‡∏°‡∏≤‡∏Å</option>
                        </select>
                    </div>
                </div>

                <div class="subtasks-section">
                    <label><i class="fas fa-list-check"></i> Sub-tasks (‡∏á‡∏≤‡∏ô‡∏¢‡πà‡∏≠‡∏¢)</label>
                    <div id="subtasksList"></div>
                    <div class="subtask-input-group">
                        <input type="text" id="subtaskInput" placeholder="‡πÄ‡∏û‡∏¥‡πà‡∏° sub-task ‡πÄ‡∏ä‡πà‡∏ô: ‡∏≠‡∏≠‡∏Å‡πÅ‡∏ö‡∏ö UI ‡∏´‡∏ô‡πâ‡∏≤ Login">
                        <button type="button" class="btn-add-subtask" onclick="addSubtask()">
                            <i class="fas fa-plus"></i> ‡πÄ‡∏û‡∏¥‡πà‡∏°
                        </button>
                    </div>
                </div>

                <div class="notification-section">
                    <label><i class="fas fa-bell"></i> ‡∏Å‡∏≤‡∏£‡πÅ‡∏à‡πâ‡∏á‡πÄ‡∏ï‡∏∑‡∏≠‡∏ô</label>
                    <div class="notification-options">
                        <label class="checkbox-label">
                            <input type="checkbox" id="notify1Week" value="7">
                            <span>‡πÅ‡∏à‡πâ‡∏á‡πÄ‡∏ï‡∏∑‡∏≠‡∏ô‡∏Å‡πà‡∏≠‡∏ô 1 ‡∏™‡∏±‡∏õ‡∏î‡∏≤‡∏´‡πå</span>
                        </label>
                        <label class="checkbox-label">
                            <input type="checkbox" id="notify3Days" value="3">
                            <span>‡πÅ‡∏à‡πâ‡∏á‡πÄ‡∏ï‡∏∑‡∏≠‡∏ô‡∏Å‡πà‡∏≠‡∏ô 3 ‡∏ß‡∏±‡∏ô</span>
                        </label>
                        <label class="checkbox-label">
                            <input type="checkbox" id="notify1Day" value="1" checked>
                            <span>‡πÅ‡∏à‡πâ‡∏á‡πÄ‡∏ï‡∏∑‡∏≠‡∏ô‡∏Å‡πà‡∏≠‡∏ô 1 ‡∏ß‡∏±‡∏ô</span>
                        </label>
                        <label class="checkbox-label">
                            <input type="checkbox" id="notify1Hour" value="0.042">
                            <span>‡πÅ‡∏à‡πâ‡∏á‡πÄ‡∏ï‡∏∑‡∏≠‡∏ô‡∏Å‡πà‡∏≠‡∏ô 1 ‡∏ä‡∏±‡πà‡∏ß‡πÇ‡∏°‡∏á</span>
                        </label>
                        <label class="checkbox-label">
                            <input type="checkbox" id="notifyOnTime" value="0">
                            <span>‡πÅ‡∏à‡πâ‡∏á‡πÄ‡∏ï‡∏∑‡∏≠‡∏ô‡πÄ‡∏°‡∏∑‡πà‡∏≠‡∏ñ‡∏∂‡∏á‡πÄ‡∏ß‡∏•‡∏≤</span>
                        </label>
                    </div>
                    <div class="notification-sound">
                        <label for="notificationSound"><i class="fas fa-volume-up"></i> ‡πÄ‡∏™‡∏µ‡∏¢‡∏á‡πÅ‡∏à‡πâ‡∏á‡πÄ‡∏ï‡∏∑‡∏≠‡∏ô</label>
                        <select id="notificationSound">
                            <option value="default">‡πÄ‡∏™‡∏µ‡∏¢‡∏á‡πÄ‡∏£‡∏¥‡πà‡∏°‡∏ï‡πâ‡∏ô</option>
                            <option value="bell">‡πÄ‡∏™‡∏µ‡∏¢‡∏á‡∏Å‡∏£‡∏∞‡∏î‡∏¥‡πà‡∏á</option>
                            <option value="chime">‡πÄ‡∏™‡∏µ‡∏¢‡∏á‡∏£‡∏∞‡∏Ü‡∏±‡∏á</option>
                            <option value="alert">‡πÄ‡∏™‡∏µ‡∏¢‡∏á‡πÄ‡∏ï‡∏∑‡∏≠‡∏ô</option>
                        </select>
                    </div>
                </div>

                <div class="story-point-preview">
                    <div class="preview-content">
                        <div class="preview-main">
                            <span>Story Point ‡∏ó‡∏µ‡πà‡∏Ñ‡∏≥‡∏ô‡∏ß‡∏ì‡πÑ‡∏î‡πâ:</span>
                            <span class="point-badge" id="previewPoint">-</span>
                        </div>
                        <div class="preview-formula" id="previewFormula"></div>
                        <div class="preview-recommendation" id="previewRecommendation"></div>
                    </div>
                </div>

                <div class="form-actions">
                    <button type="submit" class="btn-submit" id="btnSubmitTask">
                        <i class="fas fa-plus" id="btnSubmitIcon"></i> 
                        <span id="btnSubmitText">‡πÄ‡∏û‡∏¥‡πà‡∏°‡∏á‡∏≤‡∏ô‡∏´‡∏•‡∏±‡∏Å</span>
                    </button>
                    <button type="button" class="btn-cancel" id="btnCancelEdit" style="display: none;" onclick="cancelEdit()">
                        <i class="fas fa-times"></i> ‡∏¢‡∏Å‡πÄ‡∏•‡∏¥‡∏Å
                    </button>
                </div>
            </form>
        </div>

        <div class="table-container">
            <div class="table-header">
                <h2><i class="fas fa-table"></i> ‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£‡∏á‡∏≤‡∏ô‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î</h2>
                <div class="table-actions">
                    <button class="btn-secondary" onclick="exportToCSV()">
                        <i class="fas fa-download"></i> Export CSV
                    </button>
                    <button class="btn-danger" onclick="clearAll()">
                        <i class="fas fa-trash"></i> ‡∏•‡πâ‡∏≤‡∏á‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î
                    </button>
                </div>
            </div>

            <div class="tasks-list" id="tasksList">
                <div class="empty-state">
                    <i class="fas fa-inbox"></i>
                    <p>‡∏¢‡∏±‡∏á‡πÑ‡∏°‡πà‡∏°‡∏µ‡∏á‡∏≤‡∏ô‡πÉ‡∏ô‡∏£‡∏∞‡∏ö‡∏ö</p>
                    <p class="empty-hint">‡πÄ‡∏û‡∏¥‡πà‡∏°‡∏á‡∏≤‡∏ô‡πÅ‡∏£‡∏Å‡∏Ç‡∏≠‡∏á‡∏Ñ‡∏∏‡∏ì‡πÄ‡∏û‡∏∑‡πà‡∏≠‡πÄ‡∏£‡∏¥‡πà‡∏°‡∏ï‡πâ‡∏ô</p>
                </div>
            </div>
        </div>

        <!-- Shared Tasks Section -->
        <div class="table-container" id="sharedTasksContainer" style="display: none;">
            <div class="table-header">
                <h2><i class="fas fa-share-alt"></i> ‡∏á‡∏≤‡∏ô‡∏ó‡∏µ‡πà‡πÅ‡∏ä‡∏£‡πå‡πÉ‡∏´‡πâ‡∏â‡∏±‡∏ô</h2>
                <div class="table-actions">
                    <span class="shared-tasks-count" id="sharedTasksCount">0 ‡∏á‡∏≤‡∏ô</span>
                </div>
            </div>

            <div class="tasks-list" id="sharedTasksList">
                <div class="empty-state">
                    <i class="fas fa-share-alt"></i>
                    <p>‡∏¢‡∏±‡∏á‡πÑ‡∏°‡πà‡∏°‡∏µ‡∏á‡∏≤‡∏ô‡∏ó‡∏µ‡πà‡πÅ‡∏ä‡∏£‡πå‡πÉ‡∏´‡πâ‡∏Ñ‡∏∏‡∏ì</p>
                    <p class="empty-hint">‡πÄ‡∏°‡∏∑‡πà‡∏≠‡πÄ‡∏û‡∏∑‡πà‡∏≠‡∏ô‡πÅ‡∏ä‡∏£‡πå‡∏á‡∏≤‡∏ô‡πÉ‡∏´‡πâ ‡∏à‡∏∞‡πÅ‡∏™‡∏î‡∏á‡∏ó‡∏µ‡πà‡∏ô‡∏µ‡πà</p>
                </div>
            </div>
        </div>
        </div>

        <!-- Friends Page -->
        <div class="friends-page" id="friendsPage" style="display: none;">
            <div class="friends-header">
                <h2><i class="fas fa-user-friends"></i> ‡πÄ‡∏û‡∏∑‡πà‡∏≠‡∏ô</h2>
                <button class="btn-back" onclick="showTasksPage()">
                    <i class="fas fa-arrow-left"></i> ‡∏Å‡∏•‡∏±‡∏ö‡πÑ‡∏õ‡∏´‡∏ô‡πâ‡∏≤‡∏á‡∏≤‡∏ô
                </button>
            </div>

            <!-- Add Friend Form -->
            <div class="form-container">
                <h3><i class="fas fa-user-plus"></i> ‡πÄ‡∏û‡∏¥‡πà‡∏°‡πÄ‡∏û‡∏∑‡πà‡∏≠‡∏ô</h3>
                
                <form id="friendRequestForm" class="friend-request-form">
                    <div class="form-row">
                        <div class="form-group full-width">
                            <label for="friendEmail"><i class="fas fa-envelope"></i> ‡∏≠‡∏µ‡πÄ‡∏°‡∏•‡∏Ç‡∏≠‡∏á‡πÄ‡∏û‡∏∑‡πà‡∏≠‡∏ô</label>
                            <input type="email" id="friendEmail" placeholder="‡∏Å‡∏£‡∏≠‡∏Å‡∏≠‡∏µ‡πÄ‡∏°‡∏•‡∏Ç‡∏≠‡∏á‡πÄ‡∏û‡∏∑‡πà‡∏≠‡∏ô‡∏ó‡∏µ‡πà‡∏ï‡πâ‡∏≠‡∏á‡∏Å‡∏≤‡∏£‡πÄ‡∏û‡∏¥‡πà‡∏°" required>
                        </div>
                    </div>
                    <button type="submit" class="btn-submit">
                        <i class="fas fa-paper-plane"></i> ‡∏™‡πà‡∏á‡∏Ñ‡∏≥‡∏Ç‡∏≠‡πÄ‡∏õ‡πá‡∏ô‡πÄ‡∏û‡∏∑‡πà‡∏≠‡∏ô
                    </button>
                </form>
            </div>

            <!-- Pending Friend Requests -->
            <div class="pending-requests-container">
                <h3><i class="fas fa-clock"></i> ‡∏Ñ‡∏≥‡∏Ç‡∏≠‡πÄ‡∏õ‡πá‡∏ô‡πÄ‡∏û‡∏∑‡πà‡∏≠‡∏ô‡∏ó‡∏µ‡πà‡∏£‡∏≠‡∏î‡∏≥‡πÄ‡∏ô‡∏¥‡∏ô‡∏Å‡∏≤‡∏£</h3>
                <div id="pendingRequestsList" class="pending-requests-list">
                    <div class="empty-state">
                        <i class="fas fa-inbox"></i>
                        <p>‡πÑ‡∏°‡πà‡∏°‡∏µ‡∏Ñ‡∏≥‡∏Ç‡∏≠‡πÄ‡∏õ‡πá‡∏ô‡πÄ‡∏û‡∏∑‡πà‡∏≠‡∏ô‡∏ó‡∏µ‡πà‡∏£‡∏≠‡∏î‡∏≥‡πÄ‡∏ô‡∏¥‡∏ô‡∏Å‡∏≤‡∏£</p>
                    </div>
                </div>
            </div>

            <!-- Friends List -->
            <div class="friends-list-container">
                <h3><i class="fas fa-users"></i> ‡∏£‡∏≤‡∏¢‡∏ä‡∏∑‡πà‡∏≠‡πÄ‡∏û‡∏∑‡πà‡∏≠‡∏ô</h3>
                <div id="friendsList" class="friends-list">
                    <div class="empty-state">
                        <i class="fas fa-user-friends"></i>
                        <p>‡∏¢‡∏±‡∏á‡πÑ‡∏°‡πà‡∏°‡∏µ‡πÄ‡∏û‡∏∑‡πà‡∏≠‡∏ô‡πÉ‡∏ô‡∏£‡∏≤‡∏¢‡∏ä‡∏∑‡πà‡∏≠</p>
                        <p class="empty-hint">‡πÄ‡∏û‡∏¥‡πà‡∏°‡πÄ‡∏û‡∏∑‡πà‡∏≠‡∏ô‡∏Ñ‡∏ô‡πÅ‡∏£‡∏Å‡∏Ç‡∏≠‡∏á‡∏Ñ‡∏∏‡∏ì‡πÄ‡∏û‡∏∑‡πà‡∏≠‡πÄ‡∏£‡∏¥‡πà‡∏°‡∏ï‡πâ‡∏ô</p>
                    </div>
                </div>
            </div>
        </div>

        <!-- Achievements Page -->
        <div class="achievements-page" id="achievementsPage" style="display: none;">
            <div class="achievements-header">
                <h2><i class="fas fa-trophy"></i> ‡∏≠‡∏ä‡∏µ‡∏ü‡πÄ‡∏°‡∏ô‡∏ï‡πå‡πÅ‡∏•‡∏∞‡∏Ñ‡∏∞‡πÅ‡∏ô‡∏ô</h2>
                <button class="btn-back" onclick="showTasksPage()">
                    <i class="fas fa-arrow-left"></i> ‡∏Å‡∏•‡∏±‡∏ö‡πÑ‡∏õ‡∏´‡∏ô‡πâ‡∏≤‡∏á‡∏≤‡∏ô
                </button>
            </div>

            <!-- User Profile Card -->
            <div class="user-profile-card">
                <div class="user-profile-avatar-section">
                    <img id="achievementsUserAvatar" class="achievements-user-avatar" src="" alt="User" />
                    <div class="user-profile-info">
                        <h3 id="achievementsUserName">User Name</h3>
                        <p id="achievementsUserEmail">user@example.com</p>
                    </div>
                </div>
                
                <div class="user-points-level">
                    <div class="points-display">
                        <div class="points-icon"><i class="fas fa-star"></i></div>
                        <div class="points-info">
                            <div class="points-value" id="userPoints">0</div>
                            <div class="points-label">‡∏Ñ‡∏∞‡πÅ‡∏ô‡∏ô‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î</div>
                        </div>
                    </div>
                    
                    <div class="level-display">
                        <div class="level-icon"><i class="fas fa-crown"></i></div>
                        <div class="level-info">
                            <div class="level-value" id="userLevel">0</div>
                            <div class="level-label">‡∏£‡∏∞‡∏î‡∏±‡∏ö</div>
                        </div>
                    </div>
                </div>
                
                <div class="level-progress-section">
                    <div class="progress-header">
                        <span>‡∏Ñ‡∏ß‡∏≤‡∏°‡∏Ñ‡∏∑‡∏ö‡∏´‡∏ô‡πâ‡∏≤‡πÑ‡∏õ‡∏¢‡∏±‡∏á‡∏£‡∏∞‡∏î‡∏±‡∏ö‡∏ñ‡∏±‡∏î‡πÑ‡∏õ</span>
                        <span id="progressPercentage">0%</span>
                    </div>
                    <div class="progress-bar-container">
                        <div class="progress-bar" id="levelProgressBar" style="width: 0%"></div>
                    </div>
                    <div class="progress-footer">
                        <span id="currentLevelPoints">0</span>
                        <span id="nextLevelPoints">100</span>
                    </div>
                </div>
            </div>

            <!-- User Stats Cards -->
            <div class="user-stats-section">
                <h3><i class="fas fa-chart-bar"></i> ‡∏™‡∏ñ‡∏¥‡∏ï‡∏¥‡∏Ç‡∏≠‡∏á‡∏Ñ‡∏∏‡∏ì</h3>
                <div class="user-stats-grid" id="userStatsGrid">
                    <!-- Stats cards will be populated here -->
                </div>
            </div>

            <!-- Achievements Grid -->
            <div class="achievements-section">
                <h3><i class="fas fa-trophy"></i> ‡∏≠‡∏ä‡∏µ‡∏ü‡πÄ‡∏°‡∏ô‡∏ï‡πå</h3>
                <div class="achievements-grid" id="achievementsGrid">
                    <!-- Achievement cards will be populated here -->
                </div>
            </div>
        </div>

        <!-- Leaderboard Page -->
        <div class="leaderboard-page" id="leaderboardPage" style="display: none;">
            <div class="leaderboard-header">
                <h2><i class="fas fa-medal"></i> ‡∏ï‡∏≤‡∏£‡∏≤‡∏á‡∏≠‡∏±‡∏ô‡∏î‡∏±‡∏ö</h2>
                <button class="btn-back" onclick="showTasksPage()">
                    <i class="fas fa-arrow-left"></i> ‡∏Å‡∏•‡∏±‡∏ö‡πÑ‡∏õ‡∏´‡∏ô‡πâ‡∏≤‡∏á‡∏≤‡∏ô
                </button>
            </div>

            <div class="leaderboard-description">
                <p>‡πÄ‡∏õ‡∏£‡∏µ‡∏¢‡∏ö‡πÄ‡∏ó‡∏µ‡∏¢‡∏ö‡∏Ñ‡∏∞‡πÅ‡∏ô‡∏ô‡πÅ‡∏•‡∏∞‡∏≠‡∏±‡∏ô‡∏î‡∏±‡∏ö‡∏Ç‡∏≠‡∏á‡∏Ñ‡∏∏‡∏ì‡∏Å‡∏±‡∏ö‡πÄ‡∏û‡∏∑‡πà‡∏≠‡∏ô ‡πÜ</p>
            </div>

            <!-- Leaderboard Table -->
            <div class="leaderboard-container">
                <div class="leaderboard-table-wrapper">
                    <table class="leaderboard-table" id="leaderboardTable">
                        <thead>
                            <tr>
                                <th class="col-rank">‡∏≠‡∏±‡∏ô‡∏î‡∏±‡∏ö</th>
                                <th class="col-avatar"></th>
                                <th class="col-name">‡∏ä‡∏∑‡πà‡∏≠</th>
                                <th class="col-points">‡∏Ñ‡∏∞‡πÅ‡∏ô‡∏ô</th>
                                <th class="col-level">‡∏£‡∏∞‡∏î‡∏±‡∏ö</th>
                                <th class="col-achievements">‡∏≠‡∏ä‡∏µ‡∏ü‡πÄ‡∏°‡∏ô‡∏ï‡πå</th>
                            </tr>
                        </thead>
                        <tbody id="leaderboardTableBody">
                            <!-- Leaderboard rows will be populated here -->
                        </tbody>
                    </table>
                </div>

                <!-- Empty State -->
                <div id="leaderboardEmptyState" class="leaderboard-empty-state" style="display: none;">
                    <i class="fas fa-user-friends"></i>
                    <h3>‡∏¢‡∏±‡∏á‡πÑ‡∏°‡πà‡∏°‡∏µ‡πÄ‡∏û‡∏∑‡πà‡∏≠‡∏ô‡πÉ‡∏ô‡∏ï‡∏≤‡∏£‡∏≤‡∏á‡∏≠‡∏±‡∏ô‡∏î‡∏±‡∏ö</h3>
                    <p>‡πÄ‡∏û‡∏¥‡πà‡∏°‡πÄ‡∏û‡∏∑‡πà‡∏≠‡∏ô‡πÄ‡∏û‡∏∑‡πà‡∏≠‡πÄ‡∏£‡∏¥‡πà‡∏°‡πÅ‡∏Ç‡πà‡∏á‡∏Ç‡∏±‡∏ô‡πÅ‡∏•‡∏∞‡πÄ‡∏õ‡∏£‡∏µ‡∏¢‡∏ö‡πÄ‡∏ó‡∏µ‡∏¢‡∏ö‡∏Ñ‡∏∞‡πÅ‡∏ô‡∏ô</p>
                    <button class="btn-add-friends" onclick="showFriendsPage()">
                        <i class="fas fa-user-plus"></i> ‡πÄ‡∏û‡∏¥‡πà‡∏°‡πÄ‡∏û‡∏∑‡πà‡∏≠‡∏ô
                    </button>
                </div>
            </div>
        </div>
    </div>

    <!-- Login Modal -->
    <div id="loginModal" class="modal">
        <div class="modal-content">
            <h2><i class="fas fa-sign-in-alt"></i> ‡πÄ‡∏Ç‡πâ‡∏≤‡∏™‡∏π‡πà‡∏£‡∏∞‡∏ö‡∏ö</h2>
            <p>‡πÄ‡∏Ç‡πâ‡∏≤‡∏™‡∏π‡πà‡∏£‡∏∞‡∏ö‡∏ö‡πÄ‡∏û‡∏∑‡πà‡∏≠‡∏ã‡∏¥‡∏á‡∏Ñ‡πå‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏Å‡∏±‡∏ö Firebase</p>
            <div class="auth-buttons">
                <!-- Anonymous Sign-in disabled -->
                <!-- <button onclick="signInAnonymously()" class="btn-auth">
                    <i class="fas fa-user-secret"></i> ‡πÄ‡∏Ç‡πâ‡∏≤‡πÉ‡∏ä‡πâ‡πÅ‡∏ö‡∏ö‡πÑ‡∏°‡πà‡∏£‡∏∞‡∏ö‡∏∏‡∏ï‡∏±‡∏ß‡∏ï‡∏ô
                </button> -->
                <button onclick="signInWithGoogle()" class="btn-auth btn-google">
                    <i class="fab fa-google"></i> ‡πÄ‡∏Ç‡πâ‡∏≤‡∏™‡∏π‡πà‡∏£‡∏∞‡∏ö‡∏ö‡∏î‡πâ‡∏ß‡∏¢ Google
                </button>
            </div>
            <button onclick="closeLoginModal()" class="btn-close-modal">‡∏õ‡∏¥‡∏î</button>
        </div>
    </div>

    <!-- Notification Permission Modal -->
    <div id="notificationModal" class="modal">
        <div class="modal-content">
            <h2><i class="fas fa-bell"></i> ‡πÄ‡∏õ‡∏¥‡∏î‡πÉ‡∏ä‡πâ‡∏á‡∏≤‡∏ô‡∏Å‡∏≤‡∏£‡πÅ‡∏à‡πâ‡∏á‡πÄ‡∏ï‡∏∑‡∏≠‡∏ô</h2>
            <p>‡∏≠‡∏ô‡∏∏‡∏ç‡∏≤‡∏ï‡πÉ‡∏´‡πâ‡πÅ‡∏≠‡∏õ‡∏™‡πà‡∏á‡∏Å‡∏≤‡∏£‡πÅ‡∏à‡πâ‡∏á‡πÄ‡∏ï‡∏∑‡∏≠‡∏ô‡πÄ‡∏°‡∏∑‡πà‡∏≠‡∏ñ‡∏∂‡∏á‡∏Å‡∏≥‡∏´‡∏ô‡∏î‡∏á‡∏≤‡∏ô</p>
            <div class="notification-status" id="notificationStatus"></div>
            <div class="auth-buttons">
                <button type="button" class="btn-auth" id="btnEnableNotification">
                    <i class="fas fa-check"></i> ‡∏≠‡∏ô‡∏∏‡∏ç‡∏≤‡∏ï
                </button>
                <button type="button" onclick="closeNotificationModal()" class="btn-close-modal">‡∏õ‡∏¥‡∏î</button>
            </div>
        </div>
    </div>

    <!-- Share Task Modal -->
    <div id="shareTaskModal" class="modal">
        <div class="modal-content">
            <h2><i class="fas fa-share-alt"></i> ‡πÅ‡∏ä‡∏£‡πå‡∏á‡∏≤‡∏ô</h2>
            <p>‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡πÄ‡∏û‡∏∑‡πà‡∏≠‡∏ô‡∏ó‡∏µ‡πà‡∏ï‡πâ‡∏≠‡∏á‡∏Å‡∏≤‡∏£‡πÅ‡∏ä‡∏£‡πå‡∏á‡∏≤‡∏ô‡∏ô‡∏µ‡πâ</p>
            <div id="shareTaskFriendsList" class="share-friends-list">
                <!-- Friend checkboxes will be populated here -->
            </div>
            <div class="auth-buttons">
                <button type="button" class="btn-auth" id="btnShareTask">
                    <i class="fas fa-share"></i> ‡πÅ‡∏ä‡∏£‡πå‡∏á‡∏≤‡∏ô
                </button>
                <button type="button" onclick="closeShareTaskModal()" class="btn-close-modal">‡∏¢‡∏Å‡πÄ‡∏•‡∏¥‡∏Å</button>
            </div>
        </div>
    </div>

    <!-- Task Detail Modal -->
    <div id="taskDetailModal" class="modal">
        <div class="modal-content modal-content-large">
            <div class="modal-header">
                <h2><i class="fas fa-tasks"></i> ‡∏£‡∏≤‡∏¢‡∏•‡∏∞‡πÄ‡∏≠‡∏µ‡∏¢‡∏î‡∏á‡∏≤‡∏ô</h2>
                <button class="btn-close-modal-x" onclick="closeTaskDetailModal()">
                    <i class="fas fa-times"></i>
                </button>
            </div>
            
            <div class="task-detail-body">
                <!-- Task Details Section -->
                <div class="task-detail-section">
                    <h3><i class="fas fa-info-circle"></i> ‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏á‡∏≤‡∏ô</h3>
                    <div id="taskDetailInfo"></div>
                </div>
                
                <!-- Collaborators Section -->
                <div class="task-detail-section">
                    <h3><i class="fas fa-user-friends"></i> ‡∏ú‡∏π‡πâ‡∏£‡πà‡∏ß‡∏°‡∏á‡∏≤‡∏ô</h3>
                    <div id="taskDetailCollaborators"></div>
                </div>
                
                <!-- Comments Section -->
                <div class="task-detail-section">
                    <h3><i class="fas fa-comments"></i> ‡∏Ñ‡∏ß‡∏≤‡∏°‡∏Ñ‡∏¥‡∏î‡πÄ‡∏´‡πá‡∏ô</h3>
                    <div id="taskDetailComments" class="comments-container">
                        <!-- Comments will be populated here -->
                    </div>
                    <div class="comment-input-section">
                        <input type="text" id="commentInput" placeholder="‡πÄ‡∏û‡∏¥‡πà‡∏°‡∏Ñ‡∏ß‡∏≤‡∏°‡∏Ñ‡∏¥‡∏î‡πÄ‡∏´‡πá‡∏ô..." />
                        <button class="btn-add-comment" onclick="handleAddComment()">
                            <i class="fas fa-paper-plane"></i> ‡∏™‡πà‡∏á
                        </button>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Firebase Configuration -->
    <script src="firebase-config.js"></script>
    
    <!-- Application Scripts -->
    <script src="js/config.js"></script>
    <script src="js/dark-mode.js"></script>
    <script src="js/error-handler.js"></script>
    <script src="js/data-cleanup.js"></script>
    <script src="js/performance-monitor.js"></script>
    <script src="js/auth.js"></script>
    <script src="js/firebase-db.js"></script>
    <script src="js/points.js"></script>
    <script src="js/achievements.js"></script>
    <script src="js/friends.js"></script>
    <script src="js/collaboration.js"></script>
    <script src="js/leaderboard.js"></script>
    <script src="js/notifications.js"></script>
    <script src="js/calculations.js"></script>
    <script src="js/subtasks.js"></script>
    <script src="js/tasks.js"></script>
    <script src="js/render.js"></script>
    <script src="js/export.js"></script>
    <script src="js/ui.js"></script>
    <script src="js/main.js"></script>
    
    <!-- Cleanup utility (temporary - for fixing finalized field) -->
    <script src="js/finalized-field-cleanup.js"></script>
</body>
</html>
